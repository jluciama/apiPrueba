{% extends 'base.html' %}
{% block title %}
    Age Verification
{% endblock %}

{% block content %}
<body class="text-center">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-5">
                <form method="POST" action="{{ url_for('age_check_page') }}" class="form-register" style="color:white;">
                    {{ form.hidden_tag() }}
                    <h1 class="h1 mb-4 font-weight-bold">
                        AGE VERIFICATION
                    </h1>
                    <div class="form-group mb-4 d-flex justify-content-center">
                        <label for="age" class="sr-only">Age:</label>
                        <input type="text" id="age" name="age" class="form-control rounded-pill text-center" placeholder="Age" required>
                    </div>
                    <div class="form-group d-flex justify-content-center mb-4">
                        <select id="day" name="day" class="form-control rounded-pill mr-2" required>
                            <option value="" selected disabled>Day</option>
                            {% for day in range(1, 32) %}
                                <option value="{{ day }}">{{ day }}</option>
                            {% endfor %}
                        </select>
                        <select id="month" name="month" class="form-control rounded-pill mr-2" required>
                            <option value="" selected disabled>Month</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select id="year" name="year" class="form-control rounded-pill" required>
                            <option value="" selected disabled>Year</option>
                            {% for year in range(current_datetime.year - 100, current_datetime.year + 1) %}
                                <option value="{{ year }}">{{ year }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-lg btn-primary btn-login">Verify</button>
                </form>
            </div>
        </div>
    </div>
</body>

<style>
    .form-control {
        height: 50px;
    }

    .rounded-pill {
        width: 400px;
        border-radius: 0;
    }

    .btn-login {
        width: 100px;
        border-radius: 0;
    }
</style>

<script>
    function isLeapYear(year) {
        return (year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0));
    }

    function updateDayOptions(daySelect, maxDay) {
        while (daySelect.options.length > 1) {
            daySelect.remove(1);
        }
        for (var i = 1; i <= maxDay; i++) {
            var option = document.createElement('option');
            option.value = i;
            option.text = i;
            daySelect.add(option);
        }
    }

    function updateMonthOptions(monthSelect, currentMonth) {
        while (monthSelect.options.length > 1) {
            monthSelect.remove(1);
        }
        var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        for (var i = 0; i < currentMonth; i++) {
            var option = document.createElement('option');
            option.value = i + 1;
            option.text = months[i];
            monthSelect.add(option);
        }
    }

    function adjustDayOptions(month, year) {
        var daySelect = document.getElementById('day');
        var maxDay = 31;

        var currentDate = new Date();
        var currentYear = currentDate.getFullYear();
        var currentMonth = currentDate.getMonth() + 1;
        var currentDay = currentDate.getDate();

        if (year > currentYear || (year === currentYear && month > currentMonth)) {
            year = currentYear;
            month = currentMonth;
        }

        if (year === currentYear && month === currentMonth) {
            maxDay = currentDay;
        } else {
            if (month === 2) {
                maxDay = isLeapYear(year) ? 29 : 28;
            } else if ([4, 6, 9, 11].includes(month)) {
                maxDay = 30;
            }
        }

        var selectedDay = parseInt(daySelect.value);
        if (isNaN(selectedDay)) { // If the selected day is not a number (placeholder), do nothing
            return;
        }

        if (selectedDay > maxDay) {
            selectedDay = maxDay;
        }

        updateDayOptions(daySelect, maxDay);
        daySelect.value = selectedDay;
    }

    document.addEventListener('DOMContentLoaded', function() {
        var monthSelect = document.getElementById('month');
        var yearSelect = document.getElementById('year');
        var daySelect = document.getElementById('day');

        adjustDayOptions(parseInt(monthSelect.value), parseInt(yearSelect.value));

        monthSelect.addEventListener('change', function() {
            var currentYear = new Date().getFullYear();
            var selectedYear = parseInt(yearSelect.value);
            var maxMonth = currentYear === selectedYear ? new Date().getMonth() + 1 : 12;
            if (parseInt(monthSelect.value) > maxMonth) {
                monthSelect.value = maxMonth;
            }
            adjustDayOptions(parseInt(monthSelect.value), parseInt(yearSelect.value));
        });

        yearSelect.addEventListener('change', function() {
            var selectedYear = parseInt(yearSelect.value);
            var selectedMonth = parseInt(monthSelect.value);
            adjustDayOptions(selectedMonth, selectedYear);

            // If the selected year is the current year, update the month options
            if (selectedYear === new Date().getFullYear()) {
                var currentMonth = new Date().getMonth() + 1;
                updateMonthOptions(monthSelect, currentMonth);
                // If the selected month is in the future, set it to the current month
                if (selectedMonth > currentMonth) {
                    monthSelect.value = currentMonth;
                }
            }
        });
    });
</script>




{% endblock %}